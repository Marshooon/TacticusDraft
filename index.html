<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Tacticus Character Wizard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    :root {
      --bg-page: #05070b;
      --bg-main: #02040a;
      --bg-top: #171c2c;
      --bg-bottom: #080a12;
      --panel: #141722;
      --panel-soft: #191d2b;
      --accent: #f6c86c;
      --accent-soft: #8a6e32;
      --accent-cyan: #47e4ff;
      --border-soft: #2f3650;
      --text-main: #f8f9ff;
      --text-muted: #a7aec9;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: "Montserrat", "SemiBold", sans-serif;
      min-height: 100vh;
      background: radial-gradient(circle at top, #222739 0, var(--bg-page) 65%);
      color: var(--text-main);
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 16px;
    }

    .app {
      width: 100%;
      max-width: 1100px;
      display: grid;
      grid-template-columns: minmax(0, 320px) minmax(0, 420px);
      gap: 20px;
    }

    @media (max-width: 800px) {
      .app {
        grid-template-columns: 1fr;
      }
    }

    /* Wizard panel */

    .wizard {
      background: rgba(4, 6, 14, 0.95);
      border-radius: 18px;
      border: 1px solid rgba(255, 255, 255, 0.06);
      box-shadow: 0 18px 40px rgba(0, 0, 0, 0.7);
      padding: 14px 5px;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .wizard h1 {
      font-size: 1.1rem;
      margin-bottom: 2px;
    }

    .wizard-sub {
      font-size: 0.8rem;
      color: var(--text-muted);
      margin-bottom: 8px;
    }

    .step-tabs {
      display: flex;
      gap: 4px;
      margin-bottom: 6px;
      flex-wrap: wrap;
    }

    .step-tab {
      flex: 1;
      min-width: 0;
      padding: 4px 2px;
      border-radius: 999px;
      font-size: 0.7rem;
      border: 1px solid rgba(255, 255, 255, 0.08);
      background: rgba(0, 0, 0, 0.6);
      color: var(--text-muted);
      cursor: pointer;
      text-align: center;

    }

    .step-tab.active {
      background: linear-gradient(120deg, var(--accent), var(--accent-cyan));
      color: #020309;
      font-weight: 600;
      border-color: rgba(0, 0, 0, 0.8);
    }

    .wizard-step {
      display: none;
      font-size: 0.82rem;
    }

    .wizard-step.active {
      display: block;
    }

    .field {
      display: flex;
      flex-direction: column;
      gap: 4px;
      margin-bottom: 10px;
    }

    .field label {
      font-size: 0.76rem;
      color: var(--text-muted);
    }

    .four-stat-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 4px;
      padding: 4px;
    }

    .stat-box {
      background: #0d1018;
      border: 1px solid var(--border-soft);
      border-radius: 6px;
      display: flex;
      align-items: center;
      gap: 6px;
      padding: 4px 6px;
    }

    .stat-icon {
      width: 22px;
      height: 22px;
      object-fit: contain;
    }

    .field input,
    .field select {
      background: transparent !important;
      border: 1px solid var(--border-soft);
      color: white;
      appearance: none;
      padding: 4px 6px;
      border-radius: 8px;
      font-size: 0.8rem;
    }

    .field input:focus,
    .field select:focus {
      outline: 1px solid var(--accent);
    }

    .choice-row {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
    }

    .pill-btn {
      border-radius: 999px;
      border: 1px solid var(--border-soft);
      background: #050712;
      color: var(--text-main);
      padding: 4px 10px;
      font-size: 0.76rem;
      cursor: pointer;
    }

    .pill-btn.active {
      border-color: var(--accent);
      box-shadow: 0 0 10px rgba(246, 200, 108, 0.7);
      background: radial-gradient(circle at top, #34303a 0, #070811 70%);
    }

    .small-note {
      font-size: 0.72rem;
      color: var(--text-muted);
    }

    .stat-grid {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 6px;
    }

    .stat-grid .field {
      margin-bottom: 4px;
    }

    .wizard-footer {
      margin-top: 4px;
      font-size: 0.74rem;
      color: var(--text-muted);
    }

    /* Trait list */

    .trait-list {
      max-height: 130px;
      padding: 6px 8px;
      border-radius: 8px;
      border: 1px solid var(--border-soft);
      background: #050712;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .trait-option {
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 0.78rem;
      color: var(--text-main);
    }

    .trait-option input[type="checkbox"] {
      accent-color: var(--accent);
    }

    .trait-option input[type="checkbox"]:checked + span {
      color: var(--accent);
      font-weight: 600;
    }

    /* Damage type lists */

    .damage-type-list {
      max-height: 110px;
      padding: 6px 8px;
      border-radius: 8px;
      border: 1px solid var(--border-soft);
      background: #050712;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .damage-option {
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 0.78rem;
      color: var(--text-main);
    }

    .damage-option input[type="radio"] {
      accent-color: var(--accent);
    }

    .damage-option input[type="radio"]:checked + span {
      color: var(--accent);
      font-weight: 600;
    }

    /* Phone preview */

    .phone-shell {
      width: min(100%, 420px);
      margin: 0 auto;
    }

    .phone {
      position: relative;
      width: 100%;
      aspect-ratio: 9 / 18;
      border-radius: 28px;
      background: linear-gradient(145deg, #121624, #05070b);
      box-shadow:
        0 0 0 2px #000,
        0 24px 40px rgba(0, 0, 0, 0.85);
      overflow: hidden;
      padding: 10px;
    }

    .phone.rarity-common {
      box-shadow:
        0 0 0 2px #444,
        0 24px 40px rgba(0, 0, 0, 0.85);
    }

    .phone.rarity-rare {
      box-shadow:
        0 0 0 2px #3b5dd0,
        0 24px 50px rgba(0, 0, 0, 0.9);
    }

    .phone.rarity-epic {
      box-shadow:
        0 0 0 2px #9b4bdf,
        0 0 26px rgba(155, 75, 223, 0.7),
        0 24px 50px rgba(0, 0, 0, 0.9);
    }

    .phone.rarity-legendary {
      box-shadow:
        0 0 0 2px #f6c86c,
        0 0 26px rgba(246, 200, 108, 0.9),
        0 24px 50px rgba(0, 0, 0, 0.95);
    }

    .screen {
      width: 100%;
      height: 100%;
      border-radius: 20px;
      overflow: hidden;
      display: flex;
      flex-direction: column;
      position: relative;
      background-color: #02040a;
    }

    .top-panel {
      flex: 0 0 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 0;
      position: relative;
      background-color: #000000;
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
    }

    .bottom-panel {
      flex: 0 0 50%;
      background: #05070b;
      padding: 10px 10px 12px;
      display: flex;
      flex-direction: column;
      gap: 8px;
      overflow: hidden;
      font-size: 0.70rem;
    }

    .portrait-placeholder {
      font-size: 0.9rem;
      color: #ffffff;
      text-align: center;
      white-space: nowrap;
      padding: 0 4px;
    }

    .portrait-image {
      position: absolute;
      inset: 0;
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: none;
    }

    #portraitInput,
    #bgUploadInput {
      display: none;
    }

    .trait-stack {
      position: absolute;
      right: 10px;
      top: 10px;
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    /* Circular gradient ring for traits */

    .trait-circle {
      position: relative;
      width: 35px;
      height: 35px;
      border-radius: 50%;
      display: none;
      align-items: center;
      justify-content: center;
      overflow: visible;
    }

    .trait-circle::before {
      content: "";
      position: absolute;
      inset: 0;
      border-radius: 50%;
      background: linear-gradient(to bottom, #FFF7B3, #B89B72,#754535,#754535,#703F30);
    }

    .trait-circle::after {
      content: "";
      position: absolute;
      inset: 2px;
      border-radius: 50%;
      background: rgba(0, 0, 0, 0.9);
      box-shadow: 0 0 6px rgba(0, 0, 0, 0.8);
    }

    .trait-icon {
      width: 80%;
      height: 80%;
      object-fit: contain;
      position: relative;
      z-index: 2;
      display: none;
    }

    .rank-chip {
      position: absolute;
      bottom: 10px;
      left: 50%;
      transform: translateX(-50%);
      padding: 3px 10px;
      border-radius: 999px;
      background: rgba(0, 0, 0, 0.7);
      border: 1px solid rgba(255, 255, 255, 0.2);
      font-size: 0.8rem;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      text-shadow: 0 0 6px rgba(0, 0, 0, 0.9);
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .rank-chip img {
      height: 18px;
      display: none;
    }

.faction-chip {
  position: absolute;
  left: 10px;
  top: 10px;
  padding: 4px;
  border-radius: 50%;
  background: rgba(0, 0, 0, 0.7);
  border: 1px solid rgba(255, 255, 255, 0.2);
  width: 35px;
  height: 35px;
  display: flex;
  align-items: center;
  justify-content: center;
      align-items: center;
      justify-content: center;
      overflow: visible;
}

    .faction-chip::before {
      content: "";
      position: absolute;
      inset: 0;
      border-radius: 50%;
      background: linear-gradient(to bottom, #FFF7B3, #B89B72,#754535,#754535,#703F30);
    }

    .faction-chip::after {
      content: "";
      position: absolute;
      inset: 2px;
      border-radius: 50%;
      background: rgba(0, 0, 0, 0.9);
      box-shadow: 0 0 6px rgba(0, 0, 0, 0.8);
    }


.faction-icon {
  width: 30px;
  height: 30px;
  object-fit: contain;
  display: none; 
   z-index: 2;
}


    .identity-row {
      display: grid;
      grid-template-columns: 0.9fr 1.6fr 0.9fr;
      gap: 8px;
      align-items: center;
    }

    .ability-circle {
      width: 100%;
      aspect-ratio: 1 / 1;
      border-radius: 50%;
      border: 3px solid var(--accent-soft);
      background: radial-gradient(circle at 30% 0, rgba(243, 179, 76, 0.2), #05070b);
      display: flex;
      align-items: center;
      justify-content: center;
      text-align: center;
      font-size: 0.8rem;
      padding: 8px;
      box-sizing: border-box;
      color: var(--text-main);
    }

    .identity-card {
      background: radial-gradient(circle at top, #1f2435 0, #0b0e18 70%);
      border-radius: 14px;
      border: 1px solid rgba(255, 255, 255, 0.06);
      padding: 6px 8px;
      display: flex;
      flex-direction: column;
      gap: 1px;
      text-align: center;
      box-shadow:
        inset 0 0 0 1px rgba(0, 0, 0, 0.8),
        0 0 14px rgba(0, 0, 0, 0.8);
    }

    .char-name {
      font-size: 1.1rem;
      font-weight: 600;
      letter-spacing: 0.06em;
      text-transform: uppercase;
      text-shadow: 0 0 6px rgba(0, 0, 0, 0.9);
    }

    .char-title {
      font-size: 0.8rem;
      color: var(--text-muted);
    }

    .xp-bar {
      position: relative;
      height: 18px;
      border-radius: 999px;
      background: #121623;
      border: 1px solid var(--border-soft);
      overflow: hidden;
      font-size: 0.7rem;
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--text-muted);
    }

    .xp-fill {
      position: absolute;
      inset: 0;
      width: 100%;
      background: linear-gradient(90deg, #1b5260, var(--accent-cyan));
      box-shadow: 0 0 10px rgba(71, 228, 255, 0.7);
    }

    .xp-label {
      position: relative;
      z-index: 1;
      color: black;
    }

    .bottom-content {
      flex: 1;
      display: grid;
      grid-template-columns: 1.05fr 1.1fr;
      gap: 6px;
      min-height: 0;
    }

    .left-column {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .item-row {
      display: flex;
      gap: 6px;
      justify-content: space-between;
    }

    .item-slot {
      flex: 1;
      max-width: 60px;
      aspect-ratio: 1 / 1;
      clip-path: polygon(
        50% 0%,
        93% 25%,
        93% 75%,
        50% 100%,
        7% 75%,
        7% 25%
      );
      background-color: #121623;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.7rem;
      text-align: center;
      padding: 0;
      overflow: hidden;
      color: #ffffff;
    }

    .upgrade-grid {
      display: grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap: 2px;
      align-content: start;
    }

    .upgrade-cell {
      background: #121623;
      border-radius: 8px;
      border: 1px solid var(--border-soft);
      display: flex;
      align-items: center;
      justify-content: center;
      text-align: center;
      padding: 2px;
      aspect-ratio: 1 / 1;
      overflow: hidden;
      font-size: 0.62rem;
    }

    .right-column {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .stat-block {
      padding: 2px 8px;
      font-size: 0.68rem;
      display: flex;
      flex-direction: column;
      gap: 3px;
      box-shadow:
        inset 0 0 0 1px rgba(0, 0, 0, 0.7);
    }

    /* 4-stat quadrant layout */

    .stat-block.stat-quad {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      grid-auto-rows: 1fr;
      gap: 4px;
      padding: 4px;
    }

    .stat-quad-cell {
      display: flex;
      align-items: center;
      justify-content: flex-start;
      gap: 2px;
      padding: 6px 10px;
      border: 1px solid var(--border-soft);
    }

    .stat-icon {
      width: 20px;
      height: 20px;
      object-fit: contain;
    }

    .stat-quad-value {
      font-size: 0.8rem;
      text-align: left;
      margin-left: 0;
    }

    .stat-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 4px;
    }

    .stat-label {
      color: var(--text-muted);
      font-size: 0.76rem;
    }

    .stat-value {
      min-width: 40px;
      text-align: right;
      color: var(--text-main);
      font-size: 0.70rem;
    }

    .attack-line {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 6px;
      border: 1px solid var(--border-soft);
      padding: 2px 4px;
    }

    .attack-icons {
      display: flex;
      gap: 4px;
    }

    .atk-kind-icon,
    .atk-type-icon {
      width: 20px;
      height: 20px;

      display: flex;
      align-items: center;
      justify-content: center;
      overflow: hidden;
    }

    .attack-icon-img {
      width: 100%;
      height: 100%;
      object-fit: contain;
    }

    .attack-text {
      flex: 1;
      text-align: right;
      font-size: 0.68rem;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .crit-grid {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 4px;
    }

    .export-wrap {
      margin-top: 12px;
      text-align: center;
    }

    .export-button {
      padding: 8px 14px;
      border-radius: 8px;
      border: 1px solid rgba(255, 255, 255, 0.2);
      background: rgba(0, 0, 0, 0.6);
      color: white;
      cursor: pointer;
      font-size: 0.8rem;
    }

    .export-button:hover {
      border-color: var(--accent);
    }
  </style>
</head>
<body>
  <div class="app">
    <!-- WIZARD PANEL -->
    <div class="wizard">
      <h1>Tacticus Character Wizard</h1>
      <div class="wizard-sub">Pick options on the left and watch the card update on the right. Then screenshot or export for Discord.</div>

      <div class="step-tabs">
        <button class="step-tab active" data-step="1">Info</button>
        <button class="step-tab" data-step="2">Rarity</button>
        <button class="step-tab" data-step="3">Faction</button>
        <button class="step-tab" data-step="4">Visuals</button>
        <button class="step-tab" data-step="5">Stats & Gear</button>
      </div>

      <!-- Step 1: Basic info -->
      <div class="wizard-step active" data-step="1">
        <div class="field">
          <label for="nameInput">Name</label>
          <input id="nameInput" type="text" value="Marec" />
        </div>
        <div class="field">
          <label for="titleInput">Title or Type</label>
          <input id="titleInput" type="text" value="Apothecary Biologis" />
        </div>
        <div class="field">
          <label for="rankInput">Rank level</label>
    <input id="rankInput" type="number" min="1" max="60" value="12" />
    </div>

        <div class="field">
          <label>Traits</label>
          <div class="trait-list" id="traitList">
            <!-- Hook these data-icon values up to your actual filenames -->
            <label class="trait-option">
              <input type="checkbox" class="trait-checkbox" data-trait="Act of Faith" data-icon="Act_of_Faith_Icon.png" />
              <span>Act of Faith</span>
            </label>
            <label class="trait-option">
              <input type="checkbox" class="trait-checkbox" data-trait="Trait_2" data-icon="2-Man_Team_Icon.png" />
              <span>2 Man Team</span>
            </label>
            <label class="trait-option">
              <input type="checkbox" class="trait-checkbox" data-trait="Trait_3" data-icon="Ambush_Icon.png" />
              <span>Ambush</span>
            </label>
            <label class="trait-option">
              <input type="checkbox" class="trait-checkbox" data-trait="Trait_4" data-icon="Battle_Fatigue_Icon.png" />
              <span>Battle Fatigue</span>
            </label>
            <label class="trait-option">
              <input type="checkbox" class="trait-checkbox" data-trait="Trait_5" data-icon="Beast_Slayer_Icon.png" />
              <span>Beast Slayer</span>
            </label>
            <label class="trait-option">
              <input type="checkbox" class="trait-checkbox" data-trait="Trait_6" data-icon="Big_Target_Icon.png" />
              <span>Big Target</span>
            </label>
            <label class="trait-option">
              <input type="checkbox" class="trait-checkbox" data-trait="Trait_7" data-icon="Blessings_of_Khorne_Icon.png" />
              <span>Blessings of Khorne</span>
            </label>
            <label class="trait-option">
              <input type="checkbox" class="trait-checkbox" data-trait="Trait_8" data-icon="Camouflage_Icon.png" />
              <span>Camouflage</span>
            </label>
            <label class="trait-option">
              <input type="checkbox" class="trait-checkbox" data-trait="Trait_9" data-icon="Close_Combat_Weakness_Icon.png" />
              <span>Close Combat Weakness</span>
            </label>
            <label class="trait-option">
              <input type="checkbox" class="trait-checkbox" data-trait="Trait_10" data-icon="Contagions_of_Nurgle_Icon.png" />
              <span>Contagions of Nurgle</span>
            </label>
            <label class="trait-option">
              <input type="checkbox" class="trait-checkbox" data-trait="Trait_11" data-icon="Crushing_Strike_Icon.png" />
              <span>Crushing Strike</span>
            </label>
            <label class="trait-option">
              <input type="checkbox" class="trait-checkbox" data-trait="Trait_12" data-icon="Daemon_Icon.png" />
              <span>Daemon</span>
            </label>
            <label class="trait-option">
              <input type="checkbox" class="trait-checkbox" data-trait="Trait_13" data-icon="Deep_Strike_Icon.png" />
              <span>Deep Strike</span>
            </label>
            <label class="trait-option">
              <input type="checkbox" class="trait-checkbox" data-trait="Trait_14" data-icon="Dakka_Icon.png" />
              <span>Dakka</span>
            </label>
            <label class="trait-option">
              <input type="checkbox" class="trait-checkbox" data-trait="Trait_15" data-icon="Diminutive_Icon.png" />
              <span>Diminutive</span>
            </label>
            <label class="trait-option">
              <input type="checkbox" class="trait-checkbox" data-trait="Trait_16" data-icon="Emplacement_Icon.png" />
              <span>Emplacement</span>
            </label>
            <label class="trait-option">
              <input type="checkbox" class="trait-checkbox" data-trait="Trait_17" data-icon="Explodes_Icon.png" />
              <span>Explodes</span>
            </label>
            <label class="trait-option">
              <input type="checkbox" class="trait-checkbox" data-trait="Trait_18" data-icon="Final_Vengeance_Icon.png" />
              <span>Final Vengeance</span>
            </label>
            <label class="trait-option">
              <input type="checkbox" class="trait-checkbox" data-trait="Trait_49" data-icon="Flying_Icon.png" />
              <span>Flying</span>
            </label>
            <label class="trait-option">
              <input type="checkbox" class="trait-checkbox" data-trait="Trait_19" data-icon="Get_Stuck_In_Icon.png" />
              <span>Get Stuck In</span>
            </label>
            <label class="trait-option">
              <input type="checkbox" class="trait-checkbox" data-trait="Trait_20" data-icon="Healer_Icon.png" />
              <span>Healer</span>
            </label>
            <label class="trait-option">
              <input type="checkbox" class="trait-checkbox" data-trait="Trait_21" data-icon="Heavy_Weapon_Icon.png" />
              <span>Heavy Weapon</span>
            </label>
            <label class="trait-option">
              <input type="checkbox" class="trait-checkbox" data-trait="Trait_22" data-icon="Immune_Icon.png" />
              <span>Immune</span>
            </label>
            <label class="trait-option">
              <input type="checkbox" class="trait-checkbox" data-trait="Trait_23" data-icon="Indirect_Fire_Icon.png" />
              <span>Indirect Fire</span>
            </label>
            <label class="trait-option">
              <input type="checkbox" class="trait-checkbox" data-trait="Trait_24" data-icon="Infiltrate_Icon.png" />
              <span>Infiltrate</span>
            </label>
            <label class="trait-option">
              <input type="checkbox" class="trait-checkbox" data-trait="Trait_25" data-icon="Instinctive_Behaviour_Icon.png" />
              <span>Instinctive Behaviour</span>
            </label>
            <label class="trait-option">
              <input type="checkbox" class="trait-checkbox" data-trait="Trait_26" data-icon="Let_the_Galaxy_Burn_Icon.png" />
              <span>Let the Galaxy Burn</span>
            </label>
            <label class="trait-option">
              <input type="checkbox" class="trait-checkbox" data-trait="Trait_27" data-icon="Living_Metal_Icon.png" />
              <span>Living Metal</span>
            </label>
            <label class="trait-option">
              <input type="checkbox" class="trait-checkbox" data-trait="Trait_28" data-icon="Martial_Ka%27tah_Icon.png" />
              <span>Martial Ka'Tah</span>
            </label>
            <label class="trait-option">
              <input type="checkbox" class="trait-checkbox" data-trait="Trait_29" data-icon="Mechanic_Icon.png" />
              <span>Mechanic</span>
            </label>
            <label class="trait-option">
              <input type="checkbox" class="trait-checkbox" data-trait="Trait_30" data-icon="Mechanical_Icon.png" />
              <span>Mechanical</span>
            </label>
            <label class="trait-option">
              <input type="checkbox" class="trait-checkbox" data-trait="Trait_31" data-icon="Mk_X_Gravis_Icon.png" />
              <span>Mk X Gravis</span>
            </label>
            <label class="trait-option">
              <input type="checkbox" class="trait-checkbox" data-trait="Trait_32" data-icon="Objact_Icon.png" />
              <span>Object</span>
            </label>
            <label class="trait-option">
              <input type="checkbox" class="trait-checkbox" data-trait="Trait_33" data-icon="Overwatch_Icon.png" />
              <span>Overwatch</span>
            </label>
            <label class="trait-option">
              <input type="checkbox" class="trait-checkbox" data-trait="Trait_34" data-icon="Parry_Icon.png" />
              <span>Parry</span>
            </label>
            <label class="trait-option">
              <input type="checkbox" class="trait-checkbox" data-trait="Trait_35" data-icon="Psyker_Icon.png" />
              <span>Psyker</span>
            </label>
            <label class="trait-option">
              <input type="checkbox" class="trait-checkbox" data-trait="Trait_36" data-icon="Rapid_Assault_Icon.png" />
              <span>Rapid Assault</span>
            </label>
            <label class="trait-option">
              <input type="checkbox" class="trait-checkbox" data-trait="Trait_37" data-icon="Resilient_Icon.png" />
              <span>Resilient</span>
            </label>
            <label class="trait-option">
              <input type="checkbox" class="trait-checkbox" data-trait="Trait_38" data-icon="Shadow_in_the_Warp_Icon.png" />
              <span>Shadow in the Warp</span>
            </label>
            <label class="trait-option">
              <input type="checkbox" class="trait-checkbox" data-trait="Trait_39" data-icon="Steppable_Icon.png" />
              <span>Steppable</span>
            </label>
            <label class="trait-option">
              <input type="checkbox" class="trait-checkbox" data-trait="Trait_40" data-icon="Summon_Icon.png" />
              <span>Summon</span>
            </label>
            <label class="trait-option">
              <input type="checkbox" class="trait-checkbox" data-trait="Trait_41" data-icon="Suppressive_Fire_Icon.png" />
              <span>Suppressive Fire</span>
            </label>
            <label class="trait-option">
              <input type="checkbox" class="trait-checkbox" data-trait="Trait_42" data-icon="Swarm_Icon.png" />
              <span>Swarm</span>
            </label>
            <label class="trait-option">
              <input type="checkbox" class="trait-checkbox" data-trait="Trait_43" data-icon="Synapse_Icon.png" />
              <span>Synapse</span>
            </label>
            <label class="trait-option">
              <input type="checkbox" class="trait-checkbox" data-trait="Trait_44" data-icon="Terminator_Armour_Icon.png" />
              <span>Terminator Armour</span>
            </label>
            <label class="trait-option">
              <input type="checkbox" class="trait-checkbox" data-trait="Trait_45" data-icon="Terrifying_Icon.png" />
              <span>Terrifying</span>
            </label>
            <label class="trait-option">
              <input type="checkbox" class="trait-checkbox" data-trait="Trait_46" data-icon="Unstoppable_Icon.png" />
              <span>Unstoppable</span>
            </label>
            <label class="trait-option">
              <input type="checkbox" class="trait-checkbox" data-trait="Trait_47" data-icon="Vehicle_Icon.png" />
              <span>Vehicle</span>
            </label>
            <label class="trait-option">
              <input type="checkbox" class="trait-checkbox" data-trait="Trait_48" data-icon="Weaver_of_Fates_Icon.png" />
              <span>Weaver of Fates</span>
            </label>
          </div>
          <span class="small-note">Select up to 6 traits. Additional traits will not be displayed</span>
        </div>
      </div>

      <!-- Step 2: Rarity -->
      <div class="wizard-step" data-step="2">
        <div class="field">
          <label>Rarity trim</label>
          <div class="choice-row" id="rarityChoices">
            <button class="pill-btn active" data-rarity="common">Common</button>
            <button class="pill-btn" data-rarity="rare">Rare</button>
            <button class="pill-btn" data-rarity="epic">Epic</button>
            <button class="pill-btn" data-rarity="legendary">Legendary</button>
          </div>
          <span class="small-note">Each rarity changes the outer glow. You can tune the colors in CSS.</span>
        </div>
      </div>

      <!-- Step 3: Faction -->
<div class="wizard-step" data-step="3">
  <div class="field">
    <label>Faction</label>

    <div class="damage-type-list" id="factionList">
      <!-- One checkbox, but acts like radio: JS will uncheck others -->
      <label class="damage-option">
        <input type="checkbox" class="faction-choice" data-faction="Adepta Sororitas" data-icon="Adepta_Sororitas_Icon.png">
        <span>Adepta Sororitas</span>
      </label>
      <label class="damage-option">
        <input type="checkbox" class="faction-choice" data-faction="Adeptus Custodes" data-icon="Adeptus_Custodes_Icon.png">
        <span>Adeptus Custodes</span>
      </label>
      <label class="damage-option">
        <input type="checkbox" class="faction-choice" data-faction="Adeptus Mechanicus" data-icon="Adeptus_Mechanicus_Icon.png">
        <span>Adeptus Mechanicus</span>
      </label>
      <label class="damage-option">
        <input type="checkbox" class="faction-choice" data-faction="Aeldari" data-icon="Aeldari_Icon.png">
        <span>Aeldari</span>
      </label>
      <label class="damage-option">
        <input type="checkbox" class="faction-choice" data-faction="Astra Militarum" data-icon="Astra_Militarum_Icon.png">
        <span>Astra Militarum</span>
      </label>
      <label class="damage-option">
        <input type="checkbox" class="faction-choice" data-faction="Black Legion" data-icon="Black_Legion_Icon.png">
        <span>Black Legion</span>
      </label>
      <label class="damage-option">
        <input type="checkbox" class="faction-choice" data-faction="Black Templars" data-icon="Black_Templars_Icon.png">
        <span>Black Templars</span>
      </label>
      <label class="damage-option">
        <input type="checkbox" class="faction-choice" data-faction="Blood Angels" data-icon="Blood_Angels_Icon.png">
        <span>Blood Angels</span>
      </label>
      <label class="damage-option">
        <input type="checkbox" class="faction-choice" data-faction="Dark Angels" data-icon="Dark_Angels_Icon.png">
        <span>Dark Angels</span>
      </label>
      <label class="damage-option">
        <input type="checkbox" class="faction-choice" data-faction="Death Guard" data-icon="Death_Guard_Icon.png">
        <span>Death Guard</span>
      </label>
      <label class="damage-option">
        <input type="checkbox" class="faction-choice" data-faction="Emperor's Children" data-icon="Emperor's_Children_Icon.png">
        <span>Emperor's Children</span>
      </label>
      <label class="damage-option">
        <input type="checkbox" class="faction-choice" data-faction="Genestealer Cults" data-icon="Genestealer_Cults_Icon.png">
        <span>Genestealer Cults</span>
      </label>
      <label class="damage-option">
        <input type="checkbox" class="faction-choice" data-faction="Necrons" data-icon="Necrons_Icon.png">
        <span>Necrons</span>
      </label>
      <label class="damage-option">
        <input type="checkbox" class="faction-choice" data-faction="Orks" data-icon="Orks_Icon.png">
        <span>Orks</span>
      </label>
      <label class="damage-option">
        <input type="checkbox" class="faction-choice" data-faction="Space Wolves" data-icon="Space_Wolves_Icon.png">
        <span>Space Wolves</span>
      </label>
      <label class="damage-option">
        <input type="checkbox" class="faction-choice" data-faction="Tau Empire" data-icon="Tau_Empire_Icon.png">
        <span>Tau Empire</span>
      </label>
      <label class="damage-option">
        <input type="checkbox" class="faction-choice" data-faction="Thousand Sons" data-icon="Thousand_Sons_Icon.png">
        <span>Thousand Sons</span>
      </label>
      <label class="damage-option">
        <input type="checkbox" class="faction-choice" data-faction="Tyranids" data-icon="Tyranids_Icon.png">
        <span>Tyranids</span>
      </label>
      <label class="damage-option">
        <input type="checkbox" class="faction-choice" data-faction="Ultramarines" data-icon="Ultramarines_Icon.png">
        <span>Ultramarines</span>
      </label>
      <label class="damage-option">
        <input type="checkbox" class="faction-choice" data-faction="World Eaters" data-icon="World_Eaters_Icon.png">
        <span>World Eaters</span>
      </label>
    </div>

    <span class="small-note">Only one faction may be selected.</span>
  </div>
</div>


      <!-- Step 4: Visuals -->
      <div class="wizard-step" data-step="4">
        <div class="field">
          <label>Background preset</label>
          <div class="choice-row" id="bgPresetRow">
            <button class="pill-btn" data-bg="spacewolves">Space Wolves Hall</button>
            <button class="pill-btn" data-bg="tau">Tau Chamber</button>
            <button class="pill-btn" data-bg="mechanicus">Mechanicus Manufactorum</button>
          </div>
          <span class="small-note">
            These map to files in assets/backgrounds. For example Background_SpaceWolves.jpg.
          </span>
        </div>

        <div class="field">
          <label>Portrait</label>
          <button class="pill-btn" id="portraitUploadButton" type="button">Upload portrait</button>
          <input type="file" id="portraitInput" accept="image/*" />
          <span class="small-note">If no portrait is chosen, the frame shows a prompt only.</span>
        </div>
      </div>

      <!-- Step 5: Stats & Gear -->
      <div class="wizard-step" data-step="5">
        <div class="stat-grid">
          <div class="field">
            <label>Health</label>
            <input id="statHealthInput" type="text" value="270" />
          </div>
          <div class="field">
            <label>Armor</label>
            <input id="statArmorInput" type="text" value="100" />
          </div>
          <div class="field">
            <label>Damage</label>
            <input id="statDamageInput" type="text" value="30" />
          </div>
          <div class="field">
            <label>Move Speed</label>
            <input id="statMoveInput" type="text" value="3" />
          </div>
        </div>

        <div class="field">
          <label>
            <input type="checkbox" id="meleeEnabled" checked />
            Melee Attack
          </label>
        </div>

<div id="meleeConfigGroup">
        <div class="field">
          <label>Melee Damage Type</label>
          <input id="meleeTypeInput" type="text" value="" readonly/>
        </div>

        <div class="field">
          <label>Melee damage type</label>
          <div class="damage-type-list" id="meleeDamageList">
            <label class="damage-option">
              <input type="radio" name="meleeDamageType" value="Bio" data-icon="Bio_Icon.png" />
              <span>Bio</span>
            </label>
            <label class="damage-option">
              <input type="radio" name="meleeDamageType" value="Blast" data-icon="Blast_Icon.png" />
              <span>Blast</span>
            </label>
            <label class="damage-option">
              <input type="radio" name="meleeDamageType" value="Chain" data-icon="Chain_Icon.png" />
              <span>Chain</span>
            </label>
            <label class="damage-option">
              <input type="radio" name="meleeDamageType" value="Direct" data-icon="Direct_Icon.png" />
              <span>Direct</span>
            </label>
            <label class="damage-option">
              <input type="radio" name="meleeDamageType" value="Energy" data-icon="Energy_Icon.png" />
              <span>Energy</span>
            </label>
            <label class="damage-option">
              <input type="radio" name="meleeDamageType" value="Eviscerating" data-icon="Eviscerating_Icon.png" />
              <span>Eviscerating</span>
            </label>
            <label class="damage-option">
              <input type="radio" name="meleeDamageType" value="Flame" data-icon="Flame_Icon.png" />
              <span>Flame</span>
            </label>
            <label class="damage-option">
              <input type="radio" name="meleeDamageType" value="Heavy Round" data-icon="Heavy_Round_Icon.png" />
              <span>Heavy Round</span>
            </label>
            <label class="damage-option">
              <input type="radio" name="meleeDamageType" value="Las" data-icon="Las_Icon.png" />
              <span>Las</span>
            </label>
            <label class="damage-option">
              <input type="radio" name="meleeDamageType" value="Melta" data-icon="Melta_Icon.png" />
              <span>Melta</span>
            </label>
            <label class="damage-option">
              <input type="radio" name="meleeDamageType" value="Molecular" data-icon="Molecular_Icon.png" />
              <span>Molecular</span>
            </label>
            <label class="damage-option">
              <input type="radio" name="meleeDamageType" value="Particle" data-icon="Particle_Icon.png" />
              <span>Particle</span>
            </label>
            <label class="damage-option">
              <input type="radio" name="meleeDamageType" value="Physical" data-icon="Physical_Icon.png" />
              <span>Physical</span>
            </label>
            <label class="damage-option">
              <input type="radio" name="meleeDamageType" value="Piercing" data-icon="Piercing_Icon.png" />
              <span>Piercing</span>
            </label>
            <label class="damage-option">
              <input type="radio" name="meleeDamageType" value="Plasma" data-icon="Plasma_Icon.png" />
              <span>Plasma</span>
            </label>
            <label class="damage-option">
              <input type="radio" name="meleeDamageType" value="Power" data-icon="Power_Icon.png" />
              <span>Power</span>
            </label>
            <label class="damage-option">
              <input type="radio" name="meleeDamageType" value="Projectile" data-icon="Projectile_Icon.png" />
              <span>Projectile</span>
            </label>
            <label class="damage-option">
              <input type="radio" name="meleeDamageType" value="Psychic" data-icon="Psychic_Icon.png" />
              <span>Psychic</span>
            </label>
            <label class="damage-option">
              <input type="radio" name="meleeDamageType" value="Pulse" data-icon="Pulse_Icon.png" />
              <span>Pulse</span>
            </label>
            <label class="damage-option">
              <input type="radio" name="meleeDamageType" value="Toxic" data-icon="Toxic_Icon.png" />
              <span>Toxic</span>
            </label>
          </div>
        </div>
</div>


        <div class="field">
          <label>
            <input type="checkbox" id="rangeEnabled" checked />
            Ranged Attack
          </label>
        </div>

<div id="rangeConfigGroup">
        <div class="field">
          <label>Ranged Damage Type</label>
          <input id="rangeTypeInput" type="text" value="" readonly/>
        </div>

        <div class="field">
          <label>Ranged damage type</label>
          <div class="damage-type-list" id="rangeDamageList">
            <label class="damage-option">
              <input type="radio" name="rangeDamageType" value="Bio" data-icon="Bio_Icon.png" />
              <span>Bio</span>
            </label>
            <label class="damage-option">
              <input type="radio" name="rangeDamageType" value="Blast" data-icon="Blast_Icon.png" />
              <span>Blast</span>
            </label>
            <label class="damage-option">
              <input type="radio" name="rangeDamageType" value="Chain" data-icon="Chain_Icon.png" />
              <span>Chain</span>
            </label>
            <label class="damage-option">
              <input type="radio" name="rangeDamageType" value="Direct" data-icon="Direct_Icon.png" />
              <span>Direct</span>
            </label>
            <label class="damage-option">
              <input type="radio" name="rangeDamageType" value="Energy" data-icon="Energy_Icon.png" />
              <span>Energy</span>
            </label>
            <label class="damage-option">
              <input type="radio" name="rangeDamageType" value="Eviscerating" data-icon="Eviscerating_Icon.png" />
              <span>Eviscerating</span>
            </label>
            <label class="damage-option">
              <input type="radio" name="rangeDamageType" value="Flame" data-icon="Flame_Icon.png" />
              <span>Flame</span>
            </label>
            <label class="damage-option">
              <input type="radio" name="rangeDamageType" value="Heavy Round" data-icon="Heavy_Round_Icon.png" />
              <span>Heavy Round</span>
            </label>
            <label class="damage-option">
              <input type="radio" name="rangeDamageType" value="Las" data-icon="Las_Icon.png" />
              <span>Las</span>
            </label>
            <label class="damage-option">
              <input type="radio" name="rangeDamageType" value="Melta" data-icon="Melta_Icon.png" />
              <span>Melta</span>
            </label>
            <label class="damage-option">
              <input type="radio" name="rangeDamageType" value="Molecular" data-icon="Molecular_Icon.png" />
              <span>Molecular</span>
            </label>
            <label class="damage-option">
              <input type="radio" name="rangeDamageType" value="Particle" data-icon="Particle_Icon.png" />
              <span>Particle</span>
            </label>
            <label class="damage-option">
              <input type="radio" name="rangeDamageType" value="Physical" data-icon="Physical_Icon.png" />
              <span>Physical</span>
            </label>
            <label class="damage-option">
              <input type="radio" name="rangeDamageType" value="Piercing" data-icon="Piercing_Icon.png" />
              <span>Piercing</span>
            </label>
            <label class="damage-option">
              <input type="radio" name="rangeDamageType" value="Plasma" data-icon="Plasma_Icon.png" />
              <span>Plasma</span>
            </label>
            <label class="damage-option">
              <input type="radio" name="rangeDamageType" value="Power" data-icon="Power_Icon.png" />
              <span>Power</span>
            </label>
            <label class="damage-option">
              <input type="radio" name="rangeDamageType" value="Projectile" data-icon="Projectile_Icon.png" />
              <span>Projectile</span>
            </label>
            <label class="damage-option">
              <input type="radio" name="rangeDamageType" value="Psychic" data-icon="Psychic_Icon.png" />
              <span>Psychic</span>
            </label>
            <label class="damage-option">
              <input type="radio" name="rangeDamageType" value="Pulse" data-icon="Pulse_Icon.png" />
              <span>Pulse</span>
            </label>
            <label class="damage-option">
              <input type="radio" name="rangeDamageType" value="Toxic" data-icon="Toxic_Icon.png" />
              <span>Toxic</span>
            </label>
          </div>
        </div>

        <div class="field">
          <label>Range</label>
          <select id="rangePatternSelect">
            <option value="range2">Range 2</option>
            <option value="range3">Range 3</option>
          </select>
        </div>
</div>
        <div class="field">
          <label>Number of hits</label>
          <input id="hitsInput" type="number" value="1" />
          <span class="small-note">Currently used for both melee and ranged lines.</span>
        </div>

        <div class="field">
          <label>Crit and block stats</label>
          <div class="stat-grid">
            <div class="field">
              <label>Crit Damage</label>
              <input id="critDamageInput" type="text" value="0%" />
            </div>
            <div class="field">
              <label>Crit Chance</label>
              <input id="critChanceInput" type="text" value="0%" />
            </div>
            <div class="field">
              <label>Damage Blocked</label>
              <input id="blockDamageInput" type="text" value="0%" />
            </div>
            <div class="field">
              <label>Block Chance</label>
              <input id="blockChanceInput" type="text" value="0%" />
            </div>
          </div>
        </div>

        <div class="field">
          <label>Items</label>
          <div class="stat-grid">
            <select id="itemSlot1"></select>
            <select id="itemSlot2"></select>
            <select id="itemSlot3"></select>
          </div>
          <span class="small-note">Global pool. These names will map to item icons later.</span>
        </div>

        <div class="field">
          <label>Upgrades</label>
          <div class="stat-grid">
            <select id="upgradeSlot1"></select>
            <select id="upgradeSlot2"></select>
            <select id="upgradeSlot3"></select>
            <select id="upgradeSlot4"></select>
            <select id="upgradeSlot5"></select>
            <select id="upgradeSlot6"></select>
          </div>
          <span class="small-note">Always six slots. Later you can color or icon them based on rarity.</span>
        </div>
      </div>

      <div class="wizard-footer">
        When your card looks right, zoom the browser if needed and either screenshot or use the Export button under the phone.
      </div>
    </div>

    <!-- PHONE PREVIEW -->
    <div class="phone-shell">
      <div class="phone rarity-common" id="phoneRoot">
        <div class="screen">
          <div class="top-panel" id="screenBg">
<div class="faction-chip" id="previewFactionChip">
  <img id="previewFactionIcon" class="faction-icon" alt="" />
</div>

            <label class="portrait-frame" for="portraitInput">
              <img id="portraitImage" class="portrait-image" alt="Character portrait" />
              <span class="portrait-placeholder" id="portraitPlaceholder">Tap to add portrait</span>

              <div class="trait-stack">
                <div class="trait-circle">
                  <img class="trait-icon" id="previewTrait1" />
                </div>
                <div class="trait-circle">
                  <img class="trait-icon" id="previewTrait2" />
                </div>
                <div class="trait-circle">
                  <img class="trait-icon" id="previewTrait3" />
                </div>
                <div class="trait-circle">
                  <img class="trait-icon" id="previewTrait4" />
                </div>
                <div class="trait-circle">
                  <img class="trait-icon" id="previewTrait5" />
                </div>
                <div class="trait-circle">
                  <img class="trait-icon" id="previewTrait6" />
                </div>
              </div>

            <div class="rank-chip">
               <img id="rankImg" alt="Rank" />
              <span id="previewRank">Rank 12</span>
            </div>
            </label>
          </div>

          <div class="bottom-panel">
            <div class="identity-row">
              <div class="ability-circle">
                <span>Ability: Active</span>
              </div>
              <div class="identity-card">
                <div class="char-name" id="previewName">Marec</div>
                <div class="char-title" id="previewTitle">Apothecary Biologis</div>
              </div>
              <div class="ability-circle">
                <span>Ability: Passive</span>
              </div>
            </div>

            <div class="xp-bar">
              <div class="xp-fill"></div>
              <div class="xp-label">Maximum for Current Character Rarity</div>
            </div>

            <div class="bottom-content">
              <div class="left-column">
                <div class="item-row">
                  <div class="item-slot" id="previewItem1">I1</div>
                  <div class="item-slot" id="previewItem2">I2</div>
                  <div class="item-slot" id="previewItem3">I3</div>
                </div>
                <div class="upgrade-grid">
                  <div class="upgrade-cell" id="previewUpgrade1">U1</div>
                  <div class="upgrade-cell" id="previewUpgrade2">U2</div>
                  <div class="upgrade-cell" id="previewUpgrade3">U3</div>
                  <div class="upgrade-cell" id="previewUpgrade4">U4</div>
                  <div class="upgrade-cell" id="previewUpgrade5">U5</div>
                  <div class="upgrade-cell" id="previewUpgrade6">U6</div>
                </div>
              </div>

              <div class="right-column">
                <div class="stat-block stat-quad">
                  <div class="stat-quad-cell">
                    <img src="assets/statIcons/Health_Icon.png" class="stat-icon" alt="Health" />
                    <span class="stat-quad-value" id="statHealth">270</span>
                  </div>

                  <div class="stat-quad-cell">
                    <img src="assets/statIcons/Armor_Icon.png" class="stat-icon" alt="Armor" />
                    <span class="stat-quad-value" id="statArmor">100</span>
                  </div>

                  <div class="stat-quad-cell">
                    <img src="assets/statIcons/Damage_Icon.png" class="stat-icon" alt="Damage" />
                    <span class="stat-quad-value" id="statDamage">30</span>
                  </div>

                  <div class="stat-quad-cell">
                    <img src="assets/statIcons/Move_Icon.png" class="stat-icon" alt="Move Speed" />
                    <span class="stat-quad-value" id="statMove">3</span>
                  </div>
                </div>

                <div class="stat-block">
                  <div class="attack-line" id="meleeAttackRow">
                    <div class="attack-icons">
                      <div class="atk-kind-icon">
                        <img id="meleeKindIcon" class="attack-icon-img" alt="Melee Icon" />
                      </div>
                      <div class="atk-type-icon">
                        <img id="meleeTypeIcon" class="attack-icon-img" alt="Melee Damage Type" />
                      </div>
                    </div>
                    <span class="attack-text" id="meleeAttackLine">Melee  x1</span>
                  </div>

                  <div class="attack-line" id="rangeAttackRow">
                    <div class="attack-icons">
                      <div class="atk-kind-icon">
                        <img id="rangeKindIcon" class="attack-icon-img" alt="Ranged Icon" />
                      </div>

                      <div class="atk-type-icon">
                        <img id="rangeTypeIcon" class="attack-icon-img" alt="Ranged Damage Type" />
                      </div>
                    </div>
                    <span class="attack-text" id="rangeAttackLine">Ranged  x1</span>
                  </div>
                </div>

                <div class="stat-block">
                  <div class="crit-grid">
                    <div class="stat-row">
                      <span class="stat-label">Crit Damage</span>
                      <span class="stat-value" id="critDamage">0%</span>
                    </div>
                    <div class="stat-row">
                      <span class="stat-label">Crit Chance</span>
                      <span class="stat-value" id="critChance">0%</span>
                    </div>
                    <div class="stat-row">
                      <span class="stat-label">Damage Blocked</span>
                      <span class="stat-value" id="blockDamage">0%</span>
                    </div>
                    <div class="stat-row">
                      <span class="stat-label">Block Chance</span>
                      <span class="stat-value" id="blockChance">0%</span>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div> <!-- bottom-panel -->
        </div>
      </div>

      <div class="export-wrap">
        <button class="export-button" id="exportButton">Export PNG</button>
      </div>
    </div>
  </div>

  <!-- dom-to-image-more for clean exports -->
  <script src="https://cdn.jsdelivr.net/npm/dom-to-image-more@3.3.6/dist/dom-to-image-more.min.js"></script>

  <script>
    // Step switching
    const stepTabs = document.querySelectorAll(".step-tab");
    const steps = document.querySelectorAll(".wizard-step");

    stepTabs.forEach(tab => {
      tab.addEventListener("click", () => {
        const step = tab.dataset.step;
        stepTabs.forEach(t => t.classList.toggle("active", t === tab));
        steps.forEach(s => s.classList.toggle("active", s.dataset.step === step));
      });
    });

    // Helper to bind input text to preview element
    const bindText = (inputId, previewId, transform) => {
      const input = document.getElementById(inputId);
      const preview = document.getElementById(previewId);
      if (!input || !preview) return;
      const update = () => {
        const val = input.value;
        preview.textContent = transform ? transform(val) : val;
      };
      input.addEventListener("input", update);
      update();
    };

    bindText("nameInput", "previewName");
    bindText("titleInput", "previewTitle");
    bindText("statHealthInput", "statHealth");
    bindText("statArmorInput", "statArmor");
    bindText("statDamageInput", "statDamage");
    bindText("statMoveInput", "statMove");
    bindText("critDamageInput", "critDamage");
    bindText("critChanceInput", "critChance");
    bindText("blockDamageInput", "blockDamage");
    bindText("blockChanceInput", "blockChance");

    // Rank binding and image
    const rankInput = document.getElementById("rankInput");
    const previewRank = document.getElementById("previewRank");
    const rankImg = document.getElementById("rankImg");

    function updateRank(rankVal) {
      const clean = rankVal || "1";
      previewRank.textContent = "Rank " + clean;
      const imgPath = "assets/rank/Rank_" + clean + ".png";
      rankImg.src = imgPath;
      rankImg.style.display = "inline-block";
    }

    rankInput.addEventListener("input", () => updateRank(rankInput.value));
    updateRank(rankInput.value);

    // Rarity buttons
    const phoneRoot = document.getElementById("phoneRoot");
    const rarityButtons = document.querySelectorAll("#rarityChoices .pill-btn");
    rarityButtons.forEach(btn => {
      btn.addEventListener("click", () => {
        rarityButtons.forEach(b => b.classList.remove("active"));
        btn.classList.add("active");
        const r = btn.dataset.rarity;
        phoneRoot.classList.remove("rarity-common", "rarity-rare", "rarity-epic", "rarity-legendary");
        phoneRoot.classList.add("rarity-" + r);
      });
    });

    // Faction buttons
    const factionButtons = document.querySelectorAll("#factionChoices .pill-btn");
    const previewFaction = document.getElementById("previewFaction");
    factionButtons.forEach(btn => {
      btn.addEventListener("click", () => {
        factionButtons.forEach(b => b.classList.remove("active"));
        btn.classList.add("active");
        previewFaction.textContent = btn.dataset.faction;
      });
    });

    // Trait selection: any number of traits, first 6 show as icons
    const traitCheckboxes = document.querySelectorAll(".trait-checkbox");
    const traitIcons = [
      document.getElementById("previewTrait1"),
      document.getElementById("previewTrait2"),
      document.getElementById("previewTrait3"),
      document.getElementById("previewTrait4"),
      document.getElementById("previewTrait5"),
      document.getElementById("previewTrait6")
    ];
    const traitCircles = traitIcons.map(img => img.parentElement);

    function refreshTraitCircles() {
      const selected = Array.from(traitCheckboxes)
        .filter(cb => cb.checked)
        .map(cb => cb);

      for (let i = 0; i < traitIcons.length; i++) {
        const img = traitIcons[i];
        const circle = traitCircles[i];
        const cb = selected[i];

        if (cb) {
          const iconFile = cb.dataset.icon;

          circle.style.display = "flex";
          if (iconFile) {
            img.src = `assets/traitIcons/${iconFile}`;
            img.style.display = "block";
          } else {
            img.removeAttribute("src");
            img.style.display = "none";
          }
        } else {
          circle.style.display = "none";
          img.removeAttribute("src");
          img.style.display = "none";
        }
      }
    }

    traitCheckboxes.forEach(cb => {
      cb.addEventListener("change", refreshTraitCircles);
    });
    refreshTraitCircles();

    // Background presets
    const bgPresets = {
      spacewolves: "assets/backgrounds/Background_SpaceWolves.jpg",
      tau: "assets/backgrounds/Background_Tau.jpg",
      mechanicus: "assets/backgrounds/Background_Mechanicus.jpg"
    };
    const screenBg = document.getElementById("screenBg");
    const bgPresetButtons = document.querySelectorAll("#bgPresetRow .pill-btn");

    bgPresetButtons.forEach(btn => {
      btn.addEventListener("click", () => {
        bgPresetButtons.forEach(b => b.classList.remove("active"));
        btn.classList.add("active");
        const key = btn.dataset.bg;
        const url = bgPresets[key];
        if (url) {
          screenBg.style.backgroundImage = 'url("' + url + '")';
        }
      });
    });


    // Portrait upload
    const portraitInput = document.getElementById("portraitInput");
    const portraitUploadButton = document.getElementById("portraitUploadButton");
    const portraitImage = document.getElementById("portraitImage");
    const portraitPlaceholder = document.getElementById("portraitPlaceholder");

    portraitUploadButton.addEventListener("click", () => portraitInput.click());
    portraitInput.addEventListener("change", function () {
      const file = this.files && this.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = e => {
        portraitImage.src = e.target.result;
        portraitImage.style.display = "block";
        portraitPlaceholder.style.display = "none";
      };
      reader.readAsDataURL(file);
    });

    // Melee and ranged attack lines (text)
    const meleeTypeInput = document.getElementById("meleeTypeInput");
    const rangeTypeInput = document.getElementById("rangeTypeInput");
    const hitsInput = document.getElementById("hitsInput");
    const meleeAttackLine = document.getElementById("meleeAttackLine");
    const rangeAttackLine = document.getElementById("rangeAttackLine");

    function updateAttackLines() {
      const meleeType = meleeTypeInput.value || "Melee";
      const rangeType = rangeTypeInput.value || "Ranged";
      const hits = hitsInput.value || "1";
      meleeAttackLine.textContent = meleeType + "  x" + hits;
      rangeAttackLine.textContent = rangeType + "  x" + hits;
    }

    [meleeTypeInput, rangeTypeInput, hitsInput].forEach(input => {
      input.addEventListener("input", updateAttackLines);
    });
    updateAttackLines();


// Attack toggles and visibility
const meleeEnabled = document.getElementById("meleeEnabled");
const rangeEnabled = document.getElementById("rangeEnabled");

const meleeConfigGroup = document.getElementById("meleeConfigGroup");
const rangeConfigGroup = document.getElementById("rangeConfigGroup");

const meleeAttackRow = document.getElementById("meleeAttackRow");
const rangeAttackRow = document.getElementById("rangeAttackRow");

function updateAttackVisibility() {
  // Wizard side: hide/show the config blocks entirely
  if (meleeConfigGroup) {
    meleeConfigGroup.style.display = meleeEnabled.checked ? "block" : "none";
  }
  if (rangeConfigGroup) {
    rangeConfigGroup.style.display = rangeEnabled.checked ? "block" : "none";
  }

  // Preview side: keep layout, just hide contents
  if (meleeAttackRow) {
    meleeAttackRow.style.visibility = meleeEnabled.checked ? "visible" : "hidden";
  }
  if (rangeAttackRow) {
    rangeAttackRow.style.visibility = rangeEnabled.checked ? "visible" : "hidden";
  }
}

if (meleeEnabled && rangeEnabled) {
  meleeEnabled.addEventListener("change", updateAttackVisibility);
  rangeEnabled.addEventListener("change", updateAttackVisibility);
  updateAttackVisibility();
}
    // Attack icons (kind icons)
    const meleeKindImg = document.getElementById("meleeKindIcon");
    const rangeKindImg = document.getElementById("rangeKindIcon");
    const rangePatternSelect = document.getElementById("rangePatternSelect");

    const MELEE_ICON = "assets/statIcons/Melee_Icon.png";
    const RANGE_ICON_2 = "assets/statIcons/Ranged_2_Icon.png";
    const RANGE_ICON_3 = "assets/statIcons/Ranged_3_Icon.png";

    function updateAttackIcons() {
      meleeKindImg.src = MELEE_ICON;

      const selected = rangePatternSelect.value;
      rangeKindImg.src = selected === "range3" ? RANGE_ICON_3 : RANGE_ICON_2;
    }

    rangePatternSelect.addEventListener("change", updateAttackIcons);
    updateAttackIcons();

    // Damage type icons, names, and colors

const meleeTypeImg = document.getElementById("meleeTypeIcon");
const rangeTypeImg = document.getElementById("rangeTypeIcon");

// these already exist earlier
// const meleeTypeInput = document.getElementById("meleeTypeInput");
// const rangeTypeInput = document.getElementById("rangeTypeInput");
// const meleeAttackLine = document.getElementById("meleeAttackLine");
// const rangeAttackLine = document.getElementById("rangeAttackLine");

// per damage type config  tweak these colors to match your palette
const DAMAGE_TYPE_COLORS = {
  Bio: "#7be77b",
  Blast: "#ffb347",
  Chain: "#c0c0c0",
  Direct: "#ffffff",
  Energy: "#47e4ff",
  Eviscerating: "#ff6ba3",
  Flame: "#ff7b3a",
  "Heavy Round": "#f4d35e",
  Las: "#ff4b5c",
  Melta: "#ff9a3c",
  Molecular: "#b084ff",
  Particle: "#70e1ff",
  Physical: "#f0f0f0",
  Piercing: "#ffd166",
  Plasma: "#3fc1ff",
  Power: "#f6c86c",
  Projectile: "#cccccc",
  Psychic: "#ba7cff",
  Pulse: "#55f2e3",
  Toxic: "#9df542"
};
// Faction selection list
const factionCheckboxes = document.querySelectorAll(".faction-choice");
const previewFactionIcon = document.getElementById("previewFactionIcon");

factionCheckboxes.forEach(cb => {
  cb.addEventListener("change", () => {

    if (cb.checked) {
      // uncheck all others
      factionCheckboxes.forEach(other => {
        if (other !== cb) other.checked = false;
      });

      // update badge
      const iconFile = cb.dataset.icon;
      if (iconFile) {
        previewFactionIcon.src = "assets/factionIcons/" + iconFile;
        previewFactionIcon.style.display = "block";
      } else {
        previewFactionIcon.style.display = "none";
      }
    } else {
      // if unchecked, remove badge
      previewFactionIcon.removeAttribute("src");
      previewFactionIcon.style.display = "none";
    }
  });
});

function applyDamageType(selectedRadio, imgElement, typeInput, lineElement) {
  if (selectedRadio) {
    const typeKey = selectedRadio.value;            // e.g. "Bio", "Flame", "Heavy Round"
    const iconFile = selectedRadio.dataset.icon;    // e.g. "Bio_Icon.png"
    const color = DAMAGE_TYPE_COLORS[typeKey];

    // icon
    if (iconFile && imgElement) {
      imgElement.src = "assets/damageIcons/" + iconFile;
    }

    // name field derived from type
    if (typeInput) {
      typeInput.value = typeKey;
      if (color) {
        typeInput.style.color = color;
      } else {
        typeInput.style.color = "";
      }
    }

    // attack line color
    if (lineElement) {
      if (color) {
        lineElement.style.color = color;
      } else {
        lineElement.style.color = "";
      }
    }
  } else {
    // clear when nothing selected (should not really happen for radios, but safe)
    if (imgElement) {
      imgElement.removeAttribute("src");
    }
    if (typeInput) {
      typeInput.style.color = "";
    }
    if (lineElement) {
      lineElement.style.color = "";
    }
  }
}



function updateDamageTypeFromSelection() {
  const meleeSelected = document.querySelector("input[name='meleeDamageType']:checked");
  const rangedSelected = document.querySelector("input[name='rangeDamageType']:checked");

  applyDamageType(meleeSelected, meleeTypeImg, meleeTypeInput, meleeAttackLine);
  applyDamageType(rangedSelected, rangeTypeImg, rangeTypeInput, rangeAttackLine);

  // refresh the "Melee  x1" and "Ranged  x1" text since names may have changed
  updateAttackLines();
}

// hook up listeners
document
  .querySelectorAll("input[name='meleeDamageType']")
  .forEach(r => r.addEventListener("change", updateDamageTypeFromSelection));

document
  .querySelectorAll("input[name='rangeDamageType']")
  .forEach(r => r.addEventListener("change", updateDamageTypeFromSelection));

// run once on load so defaults apply if any radios are prechecked
updateDamageTypeFromSelection();


    // Item and upgrade pools
    const itemPool = ["I1", "I2", "I3"];
    const upgradePool = ["U1", "U2", "U3", "U4", "U5", "U6"];

    function fillSelect(select, options) {
      select.innerHTML = "";
      options.forEach(name => {
        const opt = document.createElement("option");
        opt.value = name;
        opt.textContent = name;
        select.appendChild(opt);
      });
    }

    // Items
    const itemSelects = [
      document.getElementById("itemSlot1"),
      document.getElementById("itemSlot2"),
      document.getElementById("itemSlot3")
    ];
    const itemPreviews = [
      document.getElementById("previewItem1"),
      document.getElementById("previewItem2"),
      document.getElementById("previewItem3")
    ];

    itemSelects.forEach((sel, idx) => {
      fillSelect(sel, itemPool);
      sel.addEventListener("change", () => {
        const val = sel.value;
        itemPreviews[idx].textContent = val;
      });
      sel.dispatchEvent(new Event("change"));
    });

    // Upgrades
    const upgradeSelects = [
      document.getElementById("upgradeSlot1"),
      document.getElementById("upgradeSlot2"),
      document.getElementById("upgradeSlot3"),
      document.getElementById("upgradeSlot4"),
      document.getElementById("upgradeSlot5"),
      document.getElementById("upgradeSlot6")
    ];
    const upgradePreviews = [
      document.getElementById("previewUpgrade1"),
      document.getElementById("previewUpgrade2"),
      document.getElementById("previewUpgrade3"),
      document.getElementById("previewUpgrade4"),
      document.getElementById("previewUpgrade5"),
      document.getElementById("previewUpgrade6")
    ];

    upgradeSelects.forEach((sel, idx) => {
      fillSelect(sel, upgradePool);
      sel.addEventListener("change", () => {
        const val = sel.value;
        upgradePreviews[idx].textContent = val;
      });
      sel.dispatchEvent(new Event("change"));
    });


// Export HTML snapshot
const exportButton = document.getElementById("exportButton");

exportButton.addEventListener("click", () => {
  // Use the current doc HTML as-is
  const fullHtml =
    "<!DOCTYPE html>\n" + document.documentElement.outerHTML;

  // Build a downloadable HTML file
  const blob = new Blob([fullHtml], { type: "text/html" });
  const url = URL.createObjectURL(blob);

  const a = document.createElement("a");
  // Optional: name the file after the character
  const nameInput = document.getElementById("nameInput");
  const baseName = (nameInput?.value || "tacticus-card")
    .trim()
    .replace(/\s+/g, "_");
  a.download = baseName + ".html";

  a.href = url;
  document.body.appendChild(a);
  a.click();
  a.remove();
  URL.revokeObjectURL(url);
});



  </script>
</body>
</html>
